---
layout: default
title: HHC 2019
permalink: /hhc2019/
---

# Holiday Hack Challenge 2019
This christmas season I attended [Kringlecon 2: Turtle Doves](https://2019.kringlecon.com/invite) at the North Pole and participated in the [SANS Holiday Hack Challenge](https://holidayhackchallenge.com/2019/).  As always, it was a fantastic experience filled with much fun and learning.  I want to send a huge thanks to the Counter Hack team and SANS for putting on such a great event!

Without further ado, here's my experience.

## Table of Contents
* [Arriving at the North Pole](#arriving-at-the-north-pole)
* [Terminal Challenges](#terminal-challenges)
    * [Escape Ed](#escape-ed)
    * [Frosty Keypad](#frosty-keypad)
    * [Graylog](#graylog)
    * [Holiday Hack Trail](#holiday-hack-trail)
    * [Linux Path](#linu-path)
    * [Mongo Pilfer](#mongo-pilfer)
    * [Nyanshell](#nyanshell)
    * [Smart Braces](#smart-braces)
    * [Xmas Cheer Laser](#xmas-cheer-laser)
* [Objectives](#objectives)
    * [Objective 0: Talk to Santa in the Quad](#objective-0-talk-to-santa-in-the-quad)
    * [Objective 1: Find the Turtle Doves](#objective-1-find-the-turtle-doves)
    * [Objective 2: Unredact Threatening Document](#objective-2-unredact-threatening-document)
    * [Objective 3: Windows Log Analysis: Evaluate Attack Outcome](#objective-3-windows-log-analysis-evaluate-attack-outcome)
    * [Objective 4: Windows Log Analysis: Determine Attacker Technique](#objective-4-windows-log-analysis-determine-attacker-technique)
    * [Objective 5: Network Log Analysis: Determine Compromised System](#objective-5-network-log-analysis-determine-compromised-system)
    * [Objective 6: Splunk](#objective-6-splunk)
    * [Objective 7: Get Access to the Steam Tunnels](#objective-7-get-access-to-the-steam-tunnels)
    * [Objective 8: Bypassing the Frido Sleigh CAPTEHA](#objective-8-bypassing-the-frido-sleigh-capteha)
    * [Objective 9: Retrieve Scraps of Paper from Server](#objective-9-retrieve-scraps-of-paper-from-server)
    * [Objective 10: Recover Cleartext Document](#objective-10-recover-cleartext-document)
    * [Objective 11: Open the Sleigh Shop Door](#objective-11-open-the-sleigh-shop-door)
    * [Objective 12: Filter Out Poisoned Sources of Weather Data](#objective-12-filter-out-poisoned-sources-of-weather-data)
* [Narrative](#narrative)

## Arriving at the North Pole
Upon arriving at the North Pole, I was greeted by Santa himself.

![Santa at the North Pole](/assets/images/kringlecon_santa.png)

> Welcome to the North Pole and KringleCon 2!
>
> Last year, KringleCon hosted over 17,500 attendees and my castle got a little crowded.
>
> We moved the event to Elf University (Elf U for short), the North Pole’s largest venue.
>
> Please feel free to explore, watch talks, and enjoy the con!

With this conversation with Santa, I unlocked my first [narrative](#narrative).  I also came across my first [terminal challenge](#terminal-challenges).  KringleCon 2 is officially under way!

In the rest of this report, I will walk through each terminal challenge and objective put forth before me.  Cheers and happy hacking!

## Terminal Challenges

| Elf                | Name                          | Location           | Provides Hints For           |
|--------------------|-------------------------------|--------------------|------------------------------|
| Alabaster Snowball | [Nyanshell](#nyanshell)       | Speaker Unpreparedness Room  | [Objective 8](#objective-8-bypassing-the-frido-sleigh-capteha) |
| Bushy Evergreen    | [Escape ed](#escape-ed)       | Train Station      | [Objective 3](#objective-3-windows-log-analysis-evaluate-attack-outcome) |
| Holly Evergreen    | [Mongo Pilfer](#mongo-pilfer) | Netwars Room       | [Objective 10](#objective-10-recover-cleartext-document) |
| Kent Tinseltooth   | [Smart Braces](#smart-braces) | Student Union      | [Objective 11](#objective-11-open-the-sleigh-shop-door) |
| Minty Candy Cane   | [Holiday Hack Trail](#holiday-hack-trail)  | Dormitory          | [Objective 7](#objective-7-get-access-to-the-steam-tunnels)   |
| Pepper Minstix     | [Graylog](#graylog)           | Dormitory          | [Objective 9](#objective-9-retrieve-scraps-of-paper-from-server)   |
| Sparkle Redberry   | [Xmas Cheer Laser](#xmas-cheer-laser) | The Laboratory     | [Objective 5](#objective-5-network-log-analysis-determine-compromised-system)   |
| SugarPlum Mary     | [Linux Path](#linu-path)      | Hermey Hall        | [Objective 4](#objective-4-windows-log-analysis-determine-attacker-technique)   |
| Tangle Coalbox     | [Frosty Keypad](#frosty-keypad)  | The Quad           | Dormitory Access             |

### Escape ed[](#escape_ed)

In the Train Station, Busy Evergreen introduces us to the Escape Ed terminal challenge.

> Hi, I'm Bushy Evergreen. Welcome to Elf U!
>
> I'm glad you're here. I'm the target of a terrible trick.
>
> Pepper Minstix is at it again, sticking me in a text editor.
>
> Pepper is forcing me to learn ed.
>
> Even the hint is ugly. Why can't I just use Gedit?
>
> Please help me just quit the grinchy thing.

#### Hints
[ed Editor Basics](http://cs.wellesley.edu/~cs249/Resources/ed_is_the_standard_text_editor.html)

#### Walkthrough

![Escape ed Terminal](/assets/images/escape_ed1.png)

Upon entering the terminal, we were dropped into the ed editor, a linux-based editor similar to vi. To complete the challenge, we must exit the ed editor.

To exit the ed editor, we simply type "wq" and press enter.  Upon doing this, the editor exits and we get the "You did it! Congratulations!" message indicating that we completed the challenge successfully!

![Escape ed Success](/assets/images/escape_ed2.png)

Completing this terminal gave us the achievement "Escape Ed".

Bushy rewarded us greatly for helping him with this task, including dropping two hints that will come in handy on [Objective 3](#objective3)

> Wow, that was much easier than I'd thought.
> 
> Maybe I don't need a clunky GUI after all!
> 
> Have you taken a look at the password spray attack artifacts?
> 
> I'll bet that DeepBlueCLI tool is helpful.
> 
> You can check it out on GitHub.
> 
> It was written by that Eric Conrad.
> 
> He lives in Maine - not too far from here!

### Smart Braces

In the student union, Kent Tinseltooth introduces us to the Smart Braces terminal challenge.

> OK, this is starting to freak me out!
> 
> Oh sorry, I'm Kent Tinseltooth. My Smart Braces are acting up.
> 
> Do... Do you ever get the feeling you can hear things? Like, voices?
> 
> I know, I sound crazy, but ever since I got these... Oh!
> 
> Do you think you could take a look at my Smart Braces terminal?
> 
> I'll bet you can keep other students out of my head, so to speak.
> 
> It might just take a bit of Iptables work.
> 
> Oh thank you! It's so nice to be back in my own head again. Er, alone.
> 
> By the way, have you tried to get into the crate in the Student Union? It has an interesting set of locks.

#### Hints

[Iptables](https://upcloud.com/community/tutorials/configure-iptables-centos/)

#### Walkthrough

![Smart Braces Terminal](/assets/images/smart_braces1.png)

Upon entering the terminal, we very clearly see Kent's plight.  In order to help him, we must configure the iptables firewall on the system as set forth by the /home/elfuuser/IOTteethBraces.md file.

![IOT teeth braces markdown file](/assets/images/smart_braces2.png)

Using what we know about iptables and the hint provided by Kent, we must configure iptables with the following rules:
1. Set the default policies to DROP for the INPUT, FORWARD, and OUTPUT chains.
2. Create a rule to ACCEPT all connections that are ESTABLISHED,RELATED on the INPUT and the OUTPUT chains.
3. Create a rule to ACCEPT only remote source IP address 172.19.0.225 to access the local SSH server (on port 22).
4. Create a rule to ACCEPT any source IP to the local TCP services on ports 21 and 80.
5. Create a rule to ACCEPT all OUTPUT traffic with a destination TCP port of 80.
6. Create a rule applied to the INPUT chain to ACCEPT all traffic from the lo interface.

However, if we wait too long, Kent won't be able to handle it!  We have to complete the challenge in 5 minutes or less otherwise he'll tear the whole thing down.

![Kent's Impatience](/assets/images/smart_braces3.png)

Alas, we better get to it!

We must enter the following commands for each of the objectives.
1. To set the default policies, we need to issue a command for each of the three policies (using the -P flag) indicating that the action should be to drop the packet.
    * sudo iptables -P FORWARD DROP
	* sudo iptables -P INPUT DROP
	* sudo iptables -P OUTPUT DROP
2. To create a rule accepting established and related packets, we must use the -m flag to load a module "state" which looks at the state of the packet.  Then we append (using the -A flag) a rule to the INPUT and OUTPUT chains whenever the state is ESTABLISHED or RELATED.  If all these conditions are met, we jump (using the -j flag) to the ACCEPT chain to accept the packet.
    * sudo iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
	* sudo iptables -A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
3. To create a rule to acept traffic only from the given IP on SSH port 22, we append a rule to the INPUT chain that identifies traffic using the tcp protocol (-p) on port 22 (--dport for destination port) with a source (-s) of the given IP address, 172.19.0.225.  Once again, if met we accept the traffic.
    * sudo iptables -A INPUT -p tcp --dport 22 -s 172.19.0.225 -j ACCEPT
4. To accept any traffic on ports 21 and 80, we perform a very similar command as in the last step, but we leave off the -s flag with the source IP since the traffic can come from anywhere.
    * sudo iptables -A INPUT -p tcp --dport 21 -j ACCEPT
	* sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
5. To allow outgoing traffic on port 80, we perform the same command as the last step, but instead of appending the rule to the INPUT chain (indicating that the traffic is incoming), we append it to the output chain (indicating that the traffic originated on the system).
    * sudo iptables -A OUTPUT -p tcp --dport 80 -j ACCEPT
6. To allow all traffic from the lo interface, we use the -i flag to specify the interface that we want to listen on for packets.  Since we want all traffic on that interface to be accepted, no other parameters are necessary.
    * sudo iptables -A INPUT -i lo -j ACCEPT

When we enter these commands into the terminal, we get a message that we successfully hardened the smart braces firewall.  Great job!

![ip tables success message](/assets/images/smart_braces4.png)

For our help, Kent rewarded us with several hints that will come in handy for [Objective 11](#objective11).  Additionally, if we go look in the Student Union in the corner there is now a mysterious crate with lots of locks on it.  I wonder what's hiding in there.

> Oh thank you! It's so nice to be back in my own head again. Er, alone.
> 
> By the way, have you tried to get into the crate in the Student Union? It has an interesting set of locks.
> 
> There are funny rhymes, references to perspective, and odd mentions of eggs!
> 
> And if you think the stuff in your browser looks strange, you should see the page source...
> 
> Special tools? No, I don't think you'll need any extra tooling for those locks.
> 
> BUT - I'm pretty sure you'll need to use Chrome's developer tools for that one.
> 
> Or sorry, you're a Firefox fan?
> 
> Yeah, Safari's fine too - I just have an ineffible hunger for a physical Esc key.
> 
> Edge? That's cool. Hm? No no, I was thinking of an unrelated thing.
> 
> Curl fan? Right on! Just remember: the Windows one doesn't like double quotes.
> 
> Old school, huh? Oh sure - I've got what you need right here...


### Terminal Challenge[](#)

#### Hints

#### Walkthrough


## Objectives

During the course of exploring ElfU, I was challenged with the following objectives.  The sections below explain the steps taken in each objective, including how they were unlocked, any hints that were provided, what steps were taken to solve the objective, and the outcome.  Enjoy!

### Objective 0: Talk to Santa in the Quad

#### Task 

Enter the campus quad and talk to Santa.

#### Walk Through

After leaving the train station, we entered The Quad at ElfU where Santa was waiting for us.

To complete this objective, we talked to Santa in the quad and this is what he had to say.

> This is a little embarrassing, but I need your help.
> 
> Our KringleCon turtle dove mascots are missing!
> 
> They probably just wandered off.
> 
> Can you please help find them?
> 
> To help you search for them and get acquainted with KringleCon, I’ve created some objectives for you. You can see them in your badge.
> 
> Where's your badge? Oh! It's that big, circle emblem on your chest - give it a tap!
> 
> We made them in two flavors - one for our new guests, and one for those who've attended both KringleCons.

Thanks for the tip on the badge Santa!  Talking with Santa also unlocked many of the other objectives below.

#### Solution

Locate Santa in the quad and click on him to say hello.

### Objective 1: Find the Turtle Doves[](#objective1)

#### Task 

Find the missing turtle doves.

#### Walk Through

During the course of exploring ElfU, we entered the Student Union building.  It's a great place for students and visitors alike to hang out and meet people and is conveniently located across the quad from the train station!

Like most places at the North Pole, it was warm and cozy thanks to a roaring fire in the fireplace, which is where we found the two turtle doves, Michael and Jane, relaxing and warming up.

![Michael and Jane - Two Turtle Doves](/assets/images/turtle_doves.png)

Another objective down!

#### Solution

Locate the Two Turtle Doves and click on them to say hello.

### Objective 2: Unredact Threatening Document[](#objective2)

#### Task 
Someone sent a threatening letter to Elf University. What is the first word in ALL CAPS in the subject line of the letter? Please find the letter in the Quad.

#### Walk Through

While exploring ElfU and the quad, we found [a letter](https://downloads.elfu.org/LetterToElfUPersonnel.pdf) in the corner between the Student Union and Hermey Hall.  After picking up the letter, it was found to be heavily redacted.

![Redacted Letter](/assets/images/letter1.png)

However, we paid attention to the news this year, and recalled a certain incident with a [poorly redacted pdf](https://www.wired.com/story/paul-manafort-bad-tech-pdfs-passwords/).  Alas, attempting the same technique of copying and pasting from the pdf revealed that we could still get to the redacted text!

![Copying the Redacted Letter](/assets/images/letter2.png)

And that revealed to us the contents of the redacted letter as follows.

> From: A Concerned and Aggrieved Character
>
> Subject: DEMAND: Spread Holiday Cheer to Other Holidays and Mythical Characters… OR ELSE!
>
> Attention All Elf University Personnel,
>
> It remains a constant source of frustration that Elf University and the entire operation at the North Pole focuses exclusively on Mr. S. Claus and his year-end holiday spree. We URGE you to consider lending your considerable resources and expertise in providing merriment, cheer, toys, candy, and much more to other holidays year-round, as well as to other mythical characters.
>
> For centuries, we have expressed our frustration at your lack of willingness to spread your cheer beyond the inaptly-called “Holiday Season.” There are many other perfectly fine holidays and mythical characters that need your direct support year-round. 
>
> If you do not accede to our demands, we will be forced to take matters into our own hands. We do not make this threat lightly. You have less than six months to act demonstrably. 
>

It appears that someone at the North Pole is not so filled with holiday cheer and is threatening the North Pole and Christmas everywhere!

#### Solution

The first word in ALL CAPS in the subject line of the letter is...

DEMAND


### Objective 3: Windows Log Analysis: Evaluate Attack Outcome[](#objective3)

#### Task 

We're seeing attacks against the Elf U domain! Using [the event log data](https://downloads.elfu.org/Security.evtx.zip), identify the user account that the attacker compromised using a password spray attack. Bushy Evergreen is hanging out in the train station and may be able to help you out.

#### Hints

[Deep Blue CLI on Github](https://github.com/sans-blue-team/DeepBlueCLI)
[Eric Conrad on DeepBlueCLI](https://www.ericconrad.com/2016/09/deepbluecli-powershell-module-for-hunt.html)

#### Walk Through

#### Solution


### Objective 4: Windows Log Analysis: Determine Attacker Technique[](#objective4)

#### Task 

Using [these normalized Sysmon logs](https://downloads.elfu.org/sysmon-data.json.zip), identify the tool the attacker used to retrieve domain password hashes from the lsass.exe process. For hints on achieving this objective, please visit Hermey Hall and talk with SugarPlum Mary.

#### Hints

#### Walk Through

#### Solution

### Objective 5: Network Log Analysis: Determine Compromised System[](#objective5)

#### Task 

The attacks don't stop! Can you help identify the IP address of the malware-infected system using these [Zeek logs](https://downloads.elfu.org/elfu-zeeklogs.zip)? For hints on achieving this objective, please visit the Laboratory and talk with Sparkle Redberry.

#### Hints

#### Walk Through

#### Solution

### Objective 6: Splunk[](#objective6)

#### Task 

Access [https://splunk.elfu.org/](https://splunk.elfu.org/) as elf with password elfsocks. What was the message for Kent that the adversary embedded in this attack? The SOC folks at that link will help you along! For hints on achieving this objective, please visit the Laboratory in Hermey Hall and talk with Prof. Banas.

#### Hints

#### Walk Through

#### Solution

### Objective 7: Get Access to the Steam Tunnels[](#objective7)

#### Task 

Gain access to the steam tunnels. Who took the turtle doves? Please tell us their first and last name. For hints on achieving this objective, please visit Minty's dorm room and talk with Minty Candy Cane.

#### Hints

#### Walk Through

#### Solution

### Objective 8: Bypassing the Frido Sleigh CAPTEHA[](#objective8)

#### Task 

Help Krampus beat the [Frido Sleigh contest](https://fridosleigh.com/). For hints on achieving this objective, please talk with Alabaster Snowball in the Speaker Unpreparedness Room.

#### Hints

#### Walk Through

#### Solution

### Objective 9: Retrieve Scraps of Paper from Server[](#objective9)

#### Task 

Gain access to the data on the [Student Portal](https://studentportal.elfu.org/) server and retrieve the paper scraps hosted there. What is the name of Santa's cutting-edge sleigh guidance system? For hints on achieving this objective, please visit the dorm and talk with Pepper Minstix.

#### Hints

#### Walk Through

#### Solution

### Objective 10: Recover Cleartext Document[](#objective10)

#### Task 

The [Elfscrow Crypto](https://downloads.elfu.org/elfscrow.exe) tool is a vital asset used at Elf University for encrypting SUPER SECRET documents. We can't send you the source, but we do have [debug symbols](https://downloads.elfu.org/elfscrow.pdb) that you can use.

Recover the plaintext content for this [encrypted document](https://downloads.elfu.org/ElfUResearchLabsSuperSledOMaticQuickStartGuideV1.2.pdf.enc). We know that it was encrypted on December 6, 2019, between 7pm and 9pm UTC.

What is the middle line on the cover page? (Hint: it's five words)

For hints on achieving this objective, please visit the NetWars room and talk with Holly Evergreen.


#### Hints

#### Walk Through

#### Solution

### Objective 11: Open the Sleigh Shop Door[](#objective11)

#### Task 

Visit Shinny Upatree in the Student Union and help solve their problem. What is written on the paper you retrieve for Shinny?

For hints on achieving this objective, please visit the Student Union and talk with Kent Tinseltooth.

#### Hints

Thanks to Kent Tinseltooth for the following hints on various dev tools.

[Chrome Dev Tools](https://developers.google.com/web/tools/chrome-devtools)

[Curl Dev Tools](https://curl.haxx.se/docs/manpage.html)

[Edge Dev Tools](https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide/console)

[Firefox Dev Tools](https://developer.mozilla.org/en-US/docs/Tools)

[Lynx Dev Tools](https://xkcd.com/325/)

[Safari Dev Tools](https://developer.apple.com/safari/tools/)

#### Walk Through

#### Solution

### Objective 12: Filter Out Poisoned Sources of Weather Data

#### Task 

Use the data supplied in the [Zeek JSON logs](https://downloads.elfu.org/http.log.gz) to identify the IP addresses of attackers poisoning Santa's flight mapping software. [Block the 100 offending sources of information to guide Santa's sleigh](https://srf.elfu.org/) through the attack. Submit the Route ID ("RID") success value that you're given. For hints on achieving this objective, please visit the Sleigh Shop and talk with Wunorse Openslae.

#### Hints

#### Walk Through

#### Solution


## Narrative

> Whose grounds these are, I think I know
>
> His home is in the North Pole though
>
> He will not mind me traipsing here
>
> To watch his students learn and grow

* * *
